<odoo>

    <!-- Server Action koji radi posao -->
    <record id="action_notify_livechat_operators" model="ir.actions.server">
        <field name="name">Notify Livechat Operators</field>
        <field name="model_id" ref="im_livechat.model_discuss_channel"/>
        <field name="state">code</field>
        <field name="code">
if record.channel_type == 'livechat' and record.livechat_channel_id and not record.x_notified:
    for operator in record.livechat_channel_id.user_ids:
        if operator.partner_id:
            operator.partner_id.sudo()._notify_thread(
                message_type="notification",
                body="Novi Live Chat: posetilac #%s" % (record.anonymous_name or record.id),
                subject="Live Chat",
                subtype_id=env.ref('mail.mt_note').id,
            )
    record.write({'x_notified': True})
        </field>
    </record>

    <!-- Automation rule koji poziva gornji server action -->
    <record id="rule_livechat_notify_mobile" model="base.automation">
        <field name="name">Livechat Notification</field>
        <field name="model_id" ref="im_livechat.model_discuss_channel"/>
        <field name="trigger">on_create</field>
        <field name="active">True</field>
        <field name="state">code</field>
        <field name="server_action_id" ref="action_notify_livechat_operators"/>
    </record>

</odoo>
