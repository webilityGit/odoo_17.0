<odoo>
    <record id="rule_livechat_notify_mobile" model="base.automation">
        <field name="name">Livechat Notification</field>
        <field name="model_id" ref="mail.model_discuss_channel"/>
        <field name="trigger">on_create</field>
        <field name="active">True</field>
        <field name="state">code</field>
        <field name="code"><![CDATA[
if record.livechat_channel_id and not record.x_notified:
    for operator in record.livechat_channel_id.user_ids:
        if operator.partner_id:
            operator.partner_id.sudo()._notify_thread(
                message_type="notification",
                body="Novi Live Chat: posetilac #%s" % (record.name or record.id),
                subject="Live Chat",
                subtype_id=env.ref('mail.mt_note').id,
            )
    record.write({'x_notified': True})
        ]]></field>
    </record>
</odoo>
